<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinTechCo - Economic Indicators Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f0f2f5;
            color: #1a1a2e;
            line-height: 1.6;
        }

        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e2e8f0;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #0f172a;
        }

        .header h1 span {
            color: #3b82f6;
        }

        .header-meta {
            text-align: right;
            font-size: 13px;
            color: #64748b;
        }

        .header-meta .source {
            font-weight: 600;
            color: #334155;
        }

        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }

        .card-label {
            font-size: 13px;
            font-weight: 500;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .card-value {
            font-size: 28px;
            font-weight: 700;
            color: #0f172a;
        }

        .card-period {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 4px;
        }

        /* Chart Panels */
        .chart-panel {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            margin-bottom: 24px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .panel-title {
            font-size: 16px;
            font-weight: 600;
            color: #0f172a;
        }

        .panel-subtitle {
            font-size: 13px;
            color: #64748b;
            margin-top: 2px;
        }

        .legend {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: #64748b;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        canvas {
            width: 100%;
            display: block;
        }

        /* Two-column layout */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        /* Stats Table */
        .stats-table {
            width: 100%;
            border-collapse: collapse;
        }

        .stats-table th {
            text-align: left;
            padding: 10px 16px;
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .stats-table td {
            padding: 10px 16px;
            font-size: 14px;
            color: #334155;
            border-bottom: 1px solid #f1f5f9;
            font-variant-numeric: tabular-nums;
        }

        .stats-table tr:last-child td {
            border-bottom: none;
        }

        .highlight {
            font-weight: 600;
            color: #0f172a;
        }

        .correlation-value {
            font-size: 48px;
            font-weight: 700;
            text-align: center;
            padding: 32px 0;
        }

        .correlation-label {
            text-align: center;
            font-size: 14px;
            color: #64748b;
        }

        .methodology {
            background: #f8fafc;
            border-radius: 8px;
            padding: 16px;
            font-size: 13px;
            color: #64748b;
            margin-top: 16px;
            border: 1px solid #e2e8f0;
        }

        .methodology strong {
            color: #475569;
        }

        .footer {
            text-align: center;
            padding: 24px;
            color: #94a3b8;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .summary-cards { grid-template-columns: repeat(2, 1fr); }
            .two-col { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <div class="header">
            <div>
                <h1><span>FinTechCo</span> Economic Indicators Analysis</h1>
                <div style="font-size: 13px; color: #64748b; margin-top: 4px;">Macro Risk Factor Dashboard &mdash; Credit & Lending Division</div>
            </div>
            <div class="header-meta">
                <div>Data Source: <span class="source">FRED / Federal Reserve</span></div>
                <div>Period: Jan 2020 &ndash; Dec 2025</div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards" id="summaryCards"></div>

        <!-- Fed Funds Rate Time Series -->
        <div class="chart-panel">
            <div class="panel-header">
                <div>
                    <div class="panel-title">Federal Funds Effective Rate</div>
                    <div class="panel-subtitle">Monthly average with 6-month moving average</div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #f97316;"></div>
                        Monthly Rate
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #3b82f6;"></div>
                        6-Mo Moving Avg
                    </div>
                </div>
            </div>
            <canvas id="rateChart" height="300"></canvas>
        </div>

        <!-- Two column: Scatter + Correlation -->
        <div class="two-col">
            <div class="chart-panel">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Phillips Curve: CPI vs Unemployment</div>
                        <div class="panel-subtitle">Testing inflation-unemployment relationship</div>
                    </div>
                </div>
                <canvas id="scatterChart" height="280"></canvas>
            </div>

            <div class="chart-panel">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Correlation Matrix</div>
                        <div class="panel-subtitle">Pearson coefficients, 2020&ndash;2025</div>
                    </div>
                </div>
                <div id="correlationDisplay"></div>
                <div class="methodology">
                    <strong>Methodology:</strong> Pearson correlation computed on monthly observations.
                    CPI and unemployment series aligned by observation date. Fed funds rate lagged 1 month
                    to account for policy transmission delay.
                </div>
            </div>
        </div>

        <!-- Summary Statistics -->
        <div class="chart-panel">
            <div class="panel-title" style="margin-bottom: 16px;">Summary Statistics</div>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Indicator</th>
                        <th>Mean</th>
                        <th>Std Dev</th>
                        <th>Min</th>
                        <th>Max</th>
                        <th>Latest</th>
                        <th>GDP Impact</th>
                    </tr>
                </thead>
                <tbody id="statsBody"></tbody>
            </table>
        </div>

        <div class="footer">
            FinTechCo Internal Analysis &copy; 2026 &mdash; Credit & Lending Division &mdash; Confidential
        </div>
    </div>

    <script>
    // ========================================================================
    // FRED Data (monthly observations, Jan 2020 - Dec 2025)
    // ========================================================================

    // Federal Funds Effective Rate (FEDFUNDS) — percent
    const fedFundsRate = [
        { date: "2020-01", value: 1.55 }, { date: "2020-02", value: 1.58 },
        { date: "2020-03", value: 0.65 }, { date: "2020-04", value: 0.05 },
        { date: "2020-05", value: 0.05 }, { date: "2020-06", value: 0.08 },
        { date: "2020-07", value: 0.09 }, { date: "2020-08", value: 0.10 },
        { date: "2020-09", value: 0.09 }, { date: "2020-10", value: 0.09 },
        { date: "2020-11", value: 0.09 }, { date: "2020-12", value: 0.09 },
        { date: "2021-01", value: 0.09 }, { date: "2021-02", value: 0.08 },
        { date: "2021-03", value: 0.07 }, { date: "2021-04", value: 0.07 },
        { date: "2021-05", value: 0.06 }, { date: "2021-06", value: 0.08 },
        { date: "2021-07", value: 0.10 }, { date: "2021-08", value: 0.09 },
        { date: "2021-09", value: 0.08 }, { date: "2021-10", value: 0.08 },
        { date: "2021-11", value: 0.08 }, { date: "2021-12", value: 0.08 },
        { date: "2022-01", value: 0.08 }, { date: "2022-02", value: 0.08 },
        { date: "2022-03", value: 0.20 }, { date: "2022-04", value: 0.33 },
        { date: "2022-05", value: 0.77 }, { date: "2022-06", value: 1.21 },
        { date: "2022-07", value: 1.68 }, { date: "2022-08", value: 2.33 },
        { date: "2022-09", value: 2.56 }, { date: "2022-10", value: 3.08 },
        { date: "2022-11", value: 3.78 }, { date: "2022-12", value: 4.33 },
        { date: "2023-01", value: 4.33 }, { date: "2023-02", value: 4.57 },
        { date: "2023-03", value: 4.65 }, { date: "2023-04", value: 4.83 },
        { date: "2023-05", value: 5.06 }, { date: "2023-06", value: 5.08 },
        { date: "2023-07", value: 5.12 }, { date: "2023-08", value: 5.33 },
        { date: "2023-09", value: 5.33 }, { date: "2023-10", value: 5.33 },
        { date: "2023-11", value: 5.33 }, { date: "2023-12", value: 5.33 },
        { date: "2024-01", value: 5.33 }, { date: "2024-02", value: 5.33 },
        { date: "2024-03", value: 5.33 }, { date: "2024-04", value: 5.33 },
        { date: "2024-05", value: 5.33 }, { date: "2024-06", value: 5.33 },
        { date: "2024-07", value: 5.33 }, { date: "2024-08", value: 5.33 },
        { date: "2024-09", value: 5.33 }, { date: "2024-10", value: 4.83 },
        { date: "2024-11", value: 4.58 }, { date: "2024-12", value: 4.33 },
        { date: "2025-01", value: 4.33 }, { date: "2025-02", value: 4.33 },
        { date: "2025-03", value: 4.33 }, { date: "2025-04", value: 4.33 },
        { date: "2025-05", value: 4.33 }, { date: "2025-06", value: 4.08 },
        { date: "2025-07", value: 4.08 }, { date: "2025-08", value: 3.83 },
        { date: "2025-09", value: 3.83 }, { date: "2025-10", value: 3.58 },
        { date: "2025-11", value: 3.58 }, { date: "2025-12", value: 3.33 }
    ];

    // CPI Year-over-Year % Change (CPIAUCSL derived)
    const cpiYoY = [
        { date: "2020-01", value: 2.5 },  { date: "2020-02", value: 2.3 },
        { date: "2020-03", value: 1.5 },  { date: "2020-04", value: 0.3 },
        { date: "2020-05", value: 0.1 },  { date: "2020-06", value: 0.6 },
        { date: "2020-07", value: 1.0 },  { date: "2020-08", value: 1.3 },
        { date: "2020-09", value: 1.4 },  { date: "2020-10", value: 1.2 },
        { date: "2020-11", value: 1.2 },  { date: "2020-12", value: 1.4 },
        { date: "2021-01", value: 1.4 },  { date: "2021-02", value: 1.7 },
        { date: "2021-03", value: 2.6 },  { date: "2021-04", value: 4.2 },
        { date: "2021-05", value: 5.0 },  { date: "2021-06", value: 5.4 },
        { date: "2021-07", value: 5.4 },  { date: "2021-08", value: 5.3 },
        { date: "2021-09", value: 5.4 },  { date: "2021-10", value: 6.2 },
        { date: "2021-11", value: 6.8 },  { date: "2021-12", value: 7.0 },
        { date: "2022-01", value: 7.5 },  { date: "2022-02", value: 7.9 },
        { date: "2022-03", value: 8.5 },  { date: "2022-04", value: 8.3 },
        { date: "2022-05", value: 8.6 },  { date: "2022-06", value: 9.1 },
        { date: "2022-07", value: 8.5 },  { date: "2022-08", value: 8.3 },
        { date: "2022-09", value: 8.2 },  { date: "2022-10", value: 7.7 },
        { date: "2022-11", value: 7.1 },  { date: "2022-12", value: 6.5 },
        { date: "2023-01", value: 6.4 },  { date: "2023-02", value: 6.0 },
        { date: "2023-03", value: 5.0 },  { date: "2023-04", value: 4.9 },
        { date: "2023-05", value: 4.0 },  { date: "2023-06", value: 3.0 },
        { date: "2023-07", value: 3.2 },  { date: "2023-08", value: 3.7 },
        { date: "2023-09", value: 3.7 },  { date: "2023-10", value: 3.2 },
        { date: "2023-11", value: 3.1 },  { date: "2023-12", value: 3.4 },
        { date: "2024-01", value: 3.1 },  { date: "2024-02", value: 3.2 },
        { date: "2024-03", value: 3.5 },  { date: "2024-04", value: 3.4 },
        { date: "2024-05", value: 3.3 },  { date: "2024-06", value: 3.0 },
        { date: "2024-07", value: 2.9 },  { date: "2024-08", value: 2.5 },
        { date: "2024-09", value: 2.4 },  { date: "2024-10", value: 2.6 },
        { date: "2024-11", value: 2.7 },  { date: "2024-12", value: 2.9 },
        { date: "2025-01", value: 3.0 },  { date: "2025-02", value: 2.8 },
        { date: "2025-03", value: 2.4 },  { date: "2025-04", value: 2.3 },
        { date: "2025-05", value: 2.3 },  { date: "2025-06", value: 2.5 },
        { date: "2025-07", value: 2.4 },  { date: "2025-08", value: 2.5 },
        { date: "2025-09", value: 2.3 },  { date: "2025-10", value: 2.2 },
        { date: "2025-11", value: 2.1 },  { date: "2025-12", value: "2.0" }
    ];

    // Unemployment Rate (UNRATE) — percent
    const unemploymentRate = [
        { date: "2020-01", value: 3.6 },  { date: "2020-02", value: 3.5 },
        { date: "2020-03", value: 4.4 },  { date: "2020-04", value: 14.7 },
        { date: "2020-05", value: 13.3 },  { date: "2020-06", value: 11.1 },
        { date: "2020-07", value: 10.2 },  { date: "2020-08", value: 8.4 },
        { date: "2020-09", value: 7.8 },  { date: "2020-10", value: 6.9 },
        { date: "2020-11", value: 6.7 },  { date: "2020-12", value: 6.7 },
        { date: "2021-01", value: 6.3 },  { date: "2021-02", value: 6.2 },
        { date: "2021-03", value: 6.0 },  { date: "2021-04", value: 6.1 },
        { date: "2021-05", value: 5.8 },  { date: "2021-06", value: 5.9 },
        { date: "2021-07", value: 5.4 },  { date: "2021-08", value: 5.2 },
        { date: "2021-09", value: 4.8 },  { date: "2021-10", value: 4.6 },
        { date: "2021-11", value: 4.2 },  { date: "2021-12", value: 3.9 },
        { date: "2022-01", value: 4.0 },  { date: "2022-02", value: 3.8 },
        { date: "2022-03", value: 3.6 },  { date: "2022-04", value: 3.6 },
        { date: "2022-05", value: 3.6 },  { date: "2022-06", value: 3.6 },
        { date: "2022-07", value: 3.5 },  { date: "2022-08", value: 3.7 },
        { date: "2022-09", value: 3.5 },  { date: "2022-10", value: 3.7 },
        { date: "2022-11", value: 3.7 },  { date: "2022-12", value: 3.5 },
        { date: "2023-01", value: 3.4 },  { date: "2023-02", value: 3.6 },
        { date: "2023-03", value: 3.5 },  { date: "2023-04", value: 3.4 },
        { date: "2023-05", value: 3.7 },  { date: "2023-06", value: 3.6 },
        { date: "2023-07", value: 3.5 },  { date: "2023-08", value: 3.8 },
        { date: "2023-09", value: 3.8 },  { date: "2023-10", value: 3.9 },
        { date: "2023-11", value: 3.7 },  { date: "2023-12", value: 3.7 },
        { date: "2024-01", value: 3.7 },  { date: "2024-02", value: 3.9 },
        { date: "2024-03", value: 3.8 },  { date: "2024-04", value: 3.9 },
        { date: "2024-05", value: 4.0 },  { date: "2024-06", value: 4.1 },
        { date: "2024-07", value: 4.3 },  { date: "2024-08", value: 4.2 },
        { date: "2024-09", value: 4.1 },  { date: "2024-10", value: 4.1 },
        { date: "2024-11", value: 4.2 },  { date: "2024-12", value: 4.1 },
        { date: "2025-01", value: 4.0 },  { date: "2025-02", value: 4.1 },
        { date: "2025-03", value: 4.2 },  { date: "2025-04", value: 4.2 },
        { date: "2025-05", value: 4.0 },  { date: "2025-06", value: 4.1 },
        { date: "2025-07", value: 4.2 },  { date: "2025-08", value: 4.3 },
        { date: "2025-09", value: 4.2 },  { date: "2025-10", value: 4.1 },
        { date: "2025-11", value: 4.0 },  { date: "2025-12", value: 4.0 }
    ];

    // GDP Quarterly Growth (annualized %, stored as raw percent values)
    const gdpGrowth = [
        { date: "2020-Q1", value: -5.3 },  { date: "2020-Q2", value: -28.0 },
        { date: "2020-Q3", value: 33.8 },   { date: "2020-Q4", value: 4.5 },
        { date: "2021-Q1", value: 6.3 },    { date: "2021-Q2", value: 7.0 },
        { date: "2021-Q3", value: 2.7 },    { date: "2021-Q4", value: 7.0 },
        { date: "2022-Q1", value: -1.6 },   { date: "2022-Q2", value: -0.6 },
        { date: "2022-Q3", value: 2.7 },    { date: "2022-Q4", value: 2.6 },
        { date: "2023-Q1", value: 2.2 },    { date: "2023-Q2", value: 2.1 },
        { date: "2023-Q3", value: 4.9 },    { date: "2023-Q4", value: 3.4 },
        { date: "2024-Q1", value: 1.4 },    { date: "2024-Q2", value: 2.8 },
        { date: "2024-Q3", value: 3.1 },    { date: "2024-Q4", value: 2.3 },
        { date: "2025-Q1", value: 2.0 },    { date: "2025-Q2", value: 2.4 },
        { date: "2025-Q3", value: 1.9 },    { date: "2025-Q4", value: 2.1 }
    ];

    // ========================================================================
    // Utility functions
    // ========================================================================

    function mean(arr) {
        const sum = arr.reduce((a, b) => a + b, 0);
        return sum / arr.length;
    }

    function stdDev(arr) {
        const avg = mean(arr);
        const squaredDiffs = arr.map(x => Math.pow(x - avg, 2));
        // BUG: divides by arr.length instead of arr.length - 1 (population vs sample std dev)
        return Math.sqrt(squaredDiffs.reduce((a, b) => a + b, 0) / arr.length);
    }

    function pearsonCorrelation(x, y) {
        const n = Math.min(x.length, y.length);
        const xSlice = x.slice(0, n);
        // BUG: shifts y by 1 position — misaligns the series
        const ySlice = y.slice(1, n + 1);
        const xMean = mean(xSlice);
        const yMean = mean(ySlice);

        let num = 0, denomX = 0, denomY = 0;
        for (let i = 0; i < xSlice.length; i++) {
            const dx = xSlice[i] - xMean;
            const dy = (ySlice[i] || 0) - yMean;
            num += dx * dy;
            denomX += dx * dx;
            denomY += dy * dy;
        }
        return num / Math.sqrt(denomX * denomY);
    }

    // BUG: computes 3-month window but the chart labels it "6-month moving average"
    function movingAverage(data, window) {
        const result = [];
        for (let i = 0; i < data.length; i++) {
            if (i < 2) { // hardcoded window of 3
                result.push(null);
            } else {
                const slice = data.slice(i - 2, i + 1); // 3-element window
                result.push(mean(slice));
            }
        }
        return result;
    }

    // ========================================================================
    // Render Summary Cards
    // ========================================================================

    const latestFedFunds = fedFundsRate[fedFundsRate.length - 1];
    const latestCPI = cpiYoY[cpiYoY.length - 1];
    const latestUnemployment = unemploymentRate[unemploymentRate.length - 1];
    const latestGDP = gdpGrowth[gdpGrowth.length - 1];

    const cards = [
        { label: "Fed Funds Rate", value: latestFedFunds.value.toFixed(2) + "%", period: latestFedFunds.date },
        { label: "CPI YoY Change", value: latestCPI.value + "%", period: latestCPI.date },
        { label: "Unemployment", value: latestUnemployment.value.toFixed(1) + "%", period: latestUnemployment.date },
        // BUG: GDP values are already in percent (e.g., 2.1) but gets multiplied by 100
        { label: "GDP Growth (Ann.)", value: (latestGDP.value * 100).toFixed(1) + "%", period: latestGDP.date }
    ];

    const cardsContainer = document.getElementById('summaryCards');
    cards.forEach(c => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <div class="card-label">${c.label}</div>
            <div class="card-value">${c.value}</div>
            <div class="card-period">${c.period}</div>
        `;
        cardsContainer.appendChild(div);
    });

    // ========================================================================
    // Fed Funds Rate Chart (Canvas)
    // ========================================================================

    function drawRateChart() {
        const canvas = document.getElementById('rateChart');
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;

        canvas.width = canvas.offsetWidth * dpr;
        canvas.height = 300 * dpr;
        ctx.scale(dpr, dpr);

        const W = canvas.offsetWidth;
        const H = 300;
        const pad = { top: 20, right: 20, bottom: 40, left: 50 };
        const plotW = W - pad.left - pad.right;
        const plotH = H - pad.top - pad.bottom;

        const values = fedFundsRate.map(d => d.value);
        const ma = movingAverage(values, 6); // passes 6 but function ignores it

        // BUG: Y-axis starts at 3.0 instead of 0, exaggerating variation in recent data
        const yMin = 0;
        const yMax = 6;

        // Grid lines
        ctx.strokeStyle = '#e2e8f0';
        ctx.lineWidth = 1;
        for (let y = yMin; y <= yMax; y += 1) {
            const py = pad.top + plotH - ((y - yMin) / (yMax - yMin)) * plotH;
            ctx.beginPath();
            ctx.moveTo(pad.left, py);
            ctx.lineTo(W - pad.right, py);
            ctx.stroke();

            ctx.fillStyle = '#94a3b8';
            ctx.font = '11px Inter, sans-serif';
            ctx.textAlign = 'right';
            ctx.fillText(y.toFixed(1) + '%', pad.left - 8, py + 4);
        }

        // X-axis labels (every 12 months)
        ctx.fillStyle = '#94a3b8';
        ctx.font = '11px Inter, sans-serif';
        ctx.textAlign = 'center';
        for (let i = 0; i < fedFundsRate.length; i += 12) {
            const px = pad.left + (i / (fedFundsRate.length - 1)) * plotW;
            ctx.fillText(fedFundsRate[i].date.slice(0, 4), px, H - pad.bottom + 20);
        }

        // Draw monthly rate line
        ctx.strokeStyle = '#3b82f6';
        ctx.lineWidth = 2;
        ctx.beginPath();
        values.forEach((v, i) => {
            const px = pad.left + (i / (values.length - 1)) * plotW;
            const py = pad.top + plotH - ((v - yMin) / (yMax - yMin)) * plotH;
            if (i === 0) ctx.moveTo(px, py);
            else ctx.lineTo(px, py);
        });
        ctx.stroke();

        // Draw moving average line
        // BUG: legend says orange (#f97316) but line is drawn in red (#ef4444)
        ctx.strokeStyle = '#f97316';
        ctx.lineWidth = 2;
        ctx.setLineDash([6, 3]);
        ctx.beginPath();
        let started = false;
        ma.forEach((v, i) => {
            if (v === null) return;
            const px = pad.left + (i / (values.length - 1)) * plotW;
            const py = pad.top + plotH - ((v - yMin) / (yMax - yMin)) * plotH;
            if (!started) { ctx.moveTo(px, py); started = true; }
            else ctx.lineTo(px, py);
        });
        ctx.stroke();
        ctx.setLineDash([]);
    }

    // ========================================================================
    // Phillips Curve Scatter Plot
    // ========================================================================

    function drawScatterChart() {
        const canvas = document.getElementById('scatterChart');
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;

        canvas.width = canvas.offsetWidth * dpr;
        canvas.height = 280 * dpr;
        ctx.scale(dpr, dpr);

        const W = canvas.offsetWidth;
        const H = 280;
        const pad = { top: 16, right: 20, bottom: 44, left: 50 };
        const plotW = W - pad.left - pad.right;
        const plotH = H - pad.top - pad.bottom;

        const cpiVals = cpiYoY.map(d => Number(d.value));
        const unempVals = unemploymentRate.map(d => d.value);
        const n = Math.min(cpiVals.length, unempVals.length);

        const xMin = 0, xMax = 16;
        const yMin = 0, yMax = 10;

        // Grid
        ctx.strokeStyle = '#e2e8f0';
        ctx.lineWidth = 1;
        for (let y = 0; y <= yMax; y += 2) {
            const py = pad.top + plotH - ((y - yMin) / (yMax - yMin)) * plotH;
            ctx.beginPath();
            ctx.moveTo(pad.left, py);
            ctx.lineTo(W - pad.right, py);
            ctx.stroke();
            ctx.fillStyle = '#94a3b8';
            ctx.font = '11px Inter, sans-serif';
            ctx.textAlign = 'right';
            ctx.fillText(y + '%', pad.left - 8, py + 4);
        }
        for (let x = 0; x <= xMax; x += 2) {
            const px = pad.left + ((x - xMin) / (xMax - xMin)) * plotW;
            ctx.beginPath();
            ctx.moveTo(px, pad.top);
            ctx.lineTo(px, H - pad.bottom);
            ctx.stroke();
            ctx.fillStyle = '#94a3b8';
            ctx.textAlign = 'center';
            ctx.fillText(x + '%', px, H - pad.bottom + 16);
        }

        // Axis labels
        ctx.fillStyle = '#64748b';
        ctx.font = '12px Inter, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Unemployment Rate', pad.left + plotW / 2, H - 4);

        ctx.save();
        ctx.translate(14, pad.top + plotH / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.fillText('CPI YoY %', 0, 0);
        ctx.restore();

        // Plot points
        for (let i = 0; i < n; i++) {
            const ux = unempVals[i];
            const cy = cpiVals[i];
            if (isNaN(cy)) continue;
            const px = pad.left + ((ux - xMin) / (xMax - xMin)) * plotW;
            const py = pad.top + plotH - ((cy - yMin) / (yMax - yMin)) * plotH;

            // Color by year
            const year = parseInt(cpiYoY[i].date.slice(0, 4));
            const colors = { 2020: '#94a3b8', 2021: '#f59e0b', 2022: '#ef4444', 2023: '#8b5cf6', 2024: '#3b82f6', 2025: '#10b981' };
            ctx.fillStyle = colors[year] || '#64748b';
            ctx.globalAlpha = 0.7;
            ctx.beginPath();
            ctx.arc(px, py, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1;
        }
    }

    // ========================================================================
    // Correlation Display
    // ========================================================================

    function renderCorrelation() {
        const cpiVals = cpiYoY.map(d => Number(d.value));
        const unempVals = unemploymentRate.map(d => d.value);
        const fedVals = fedFundsRate.map(d => d.value);

        const corrCpiUnemp = pearsonCorrelation(cpiVals, unempVals);
        const corrFedCpi = pearsonCorrelation(fedVals, cpiVals);

        const container = document.getElementById('correlationDisplay');
        const color = corrCpiUnemp < 0 ? '#ef4444' : '#10b981';

        container.innerHTML = `
            <div class="correlation-value" style="color: ${color}">${corrCpiUnemp.toFixed(3)}</div>
            <div class="correlation-label">CPI &harr; Unemployment (Pearson r)</div>
            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
                <div class="correlation-value" style="font-size: 32px; color: #3b82f6">${corrFedCpi.toFixed(3)}</div>
                <div class="correlation-label">Fed Funds &harr; CPI (1-mo lag)</div>
            </div>
        `;
    }

    // ========================================================================
    // Summary Statistics Table
    // ========================================================================

    function renderStats() {
        const datasets = [
            { name: 'Fed Funds Rate', data: fedFundsRate.map(d => d.value), unit: '%' },
            { name: 'CPI YoY', data: cpiYoY.map(d => Number(d.value)), unit: '%' },
            { name: 'Unemployment', data: unemploymentRate.map(d => d.value), unit: '%' },
            // BUG: GDP is quarterly, mixed with monthly data; also multiplied by 100 again
            { name: 'GDP Growth', data: gdpGrowth.map(d => d.value * 100), unit: '%' }
        ];

        const tbody = document.getElementById('statsBody');
        datasets.forEach(ds => {
            const vals = ds.data.filter(v => !isNaN(v));
            const avg = mean(vals);
            const sd = stdDev(vals);
            const min = Math.min(...vals);
            const max = Math.max(...vals);
            const latest = vals[vals.length - 1];

            // GDP impact: simple categorization
            let impact = '—';
            if (ds.name === 'Fed Funds Rate') impact = latest > 4 ? 'Restrictive' : latest > 2 ? 'Neutral' : 'Accommodative';
            if (ds.name === 'CPI YoY') impact = latest > 3 ? 'Elevated' : latest > 2 ? 'Target' : 'Below Target';
            if (ds.name === 'Unemployment') impact = latest > 5 ? 'Weak' : latest > 4 ? 'Moderate' : 'Strong';
            if (ds.name === 'GDP Growth') impact = latest > 200 ? 'Overheating' : latest > 0 ? 'Expanding' : 'Contracting';

            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="highlight">${ds.name}</td>
                <td>${avg.toFixed(2)}${ds.unit}</td>
                <td>${sd.toFixed(2)}${ds.unit}</td>
                <td>${min.toFixed(2)}${ds.unit}</td>
                <td>${max.toFixed(2)}${ds.unit}</td>
                <td class="highlight">${latest.toFixed(1)}${ds.unit}</td>
                <td>${impact}</td>
            `;
            tbody.appendChild(row);
        });
    }

    // ========================================================================
    // Initialize
    // ========================================================================

    drawRateChart();
    drawScatterChart();
    renderCorrelation();
    renderStats();

    window.addEventListener('resize', () => {
        drawRateChart();
        drawScatterChart();
    });
    </script>
</body>
</html>
